#!/bin/bash

# Git pre-commit hook to run go fmt on all Go files
# This ensures all Go code is properly formatted before committing
# We also need to run make ci as this is a check in PRs.

# Get list of staged Go files
staged_go_files=$(git diff --cached --name-only --diff-filter=ACM | grep '\.go$')

# Run go fmt on staged Go files
echo "Running go fmt on staged Go files..."
for file in $staged_go_files; do
    # Only process files that still exist (not deleted)
    if [ -f "$file" ]; then
        echo "Formatting: $file"
        go fmt "$file"
        
        # Add the formatted file back to staging area
        git add "$file"
    fi
done

echo "Go formatting complete."

echo "Running make ci"
make ci
exit 0